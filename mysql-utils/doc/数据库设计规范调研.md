# TDSQL数据库设计规范调研

## 概述

数据库设计规范用于指导各应用系统数据库的设计原则、数据库命名编写规范、数据库结构设计、数据库操作规范、数据存储规范、数据库运用、数据库性能设计、数据库外部设计、数据库版本控制、数据库安全性设计等方面内容，明确了应用系统数据库的安全性、完整性，并针对数据库进行外部设计、结构设计和运用设计，统一各应用系统的数据库设计和开发，为数据采集、数据存储、数据传输、数据共享和交互做好准备。


### 数据库规范的定义和分类

#### 数据库定义

TDSQL
TDSQL MySQL版（TDSQL for MySQL）是部署在腾讯云上的一种支持自动水平拆分、Shared Nothing 架构的分布式数据库。TDSQL MySQL版 即业务获取的是完整的逻辑库表，而后端会将库表均匀的拆分到多个物理分片节点。
TDSQL MySQL版 默认部署主备架构，提供容灾、备份、恢复、监控、迁移等全套解决方案，适用于 TB 或 PB 级的海量数据库场景。
TDSQL MySQL版 提供不同的引擎供用户选择，两者均兼容 MySQL 标准协议：
InnoDB 版采用 InnoDB 作为数据存储引擎，是 MySQL 的默认存储引擎。
TDStore 版采用腾讯云自研的新敏态引擎 TDstore 作为数据存储引擎，该引擎可以有效解决客户业务发展过程中业务形态、业务量的不可预知性，适配金融敏态业务。
数据库 Database
按照概念结构组织的数据的汇集，它描述这些数据的特征及与数据对应的实体间的关系并支持一个或多个应用领域。

表 Table
数据的一种排列，其中每一项可通过变元或关键字标识。

https://www.nmpa.gov.cn/directory/web/nmpa/images/uL28jQgyv2+3biyei8xrnmt7ajqNX3xPS4rz7uOWjqS5wZGY=.pdf#page=7&zoom=100,90,113

https://pic.doit.com.cn/sdss2022/SDSSwhitepaper.pdf

视图 View
视图是原始数据库数据的一种变换，是查看表中数据的另外一种方式。可以将视图看成是一个移动的窗口，通过它可以看到感兴趣的数据。
视图是从一个或多个实际表中获得的，这些表的数据存放在数据库中。那些用于产生视图的表叫做该视图的基表。一个视图也可以从另一个视图中产生。

触发器 Trigger
触发器是一种特殊类型的存储过程，它不同于我们前面介绍过的存储过程。触发器主要是通过事件进行触发而被执行的，而存储过程可以通过存储过程名字而被直接调用。当对某一表进行诸如 UPDATE、INSERT、 DELETE 这些操作时，数据库会自动执行触发器所定义的 SQL 语句，从而确保对数据的处理必须符合由这些 SQL 语句所定义的规则。

索引 Index
索引是一个单独的、物理的数据库结构，它是某个表中一列或若干列值的集合和相应的指向表中物理标识这些值的数据页的逻辑指针清单。

存储过程 Storage process
存储过程是由流控制和 SQL 语句书写的过程，这个过程经编译和优化后存储在数据库服务器中，使用时只要调用即可。其中，若干个有联系的过程可以组合在一起构成程序包。

联机事务处理系统 On-Line transaction processing（OLTP）
联机事务处理系统(OLTP)，也称为面向交易的处理系统，其基本特征是原始数据可以立即传送到计算中心进行处理，并在很短的时间内给出处理结果。这样做的最大优点是可以即时地处理输入的数据，及时地回答。也称为实时系统 (Real time System)。衡量联机事务处理系统的一个重要性能指标是系统性能，具体体现为实时响应时间(Response Time)，即用户在终端上送入数据之后，到计算机对这个请求给出答复所需要的时间。

联机分析处理 On-Line Analysis Processing（OLAP）
联机分析处理是共享多维信息的、针对特定问题的联机数据访问和分析的快速软件技术。它通过对信息的多种可能的观察形式进行快速、稳定一致和交互性的存取，允许管理决策人员对数据进行深入观察。决策数据是多维数据，多维数据就是决策的主要内容。OLAP 专门设计用于支持复杂的分析操作，侧重对决策人员和高层管理人员的决策支持，可以根据分析人员的要求快速、灵活的进行大数据量的复杂查询处理，并且以一种直观而易懂的形式将查询结果提供给决策人员，以便他们准确掌握经营状况，了解对象的需求，制定正确的方案。

参照完整性 Referential integrity
参照完整性，简单的说就是表间主键外键的关系。参照完整性属于表间规则。对于永久关系的相关表，在更新、插入或删除记录时，如果只改其一不改其二，就会影响数据的完整性。例如：修改父表中关键字值后，子表关键字值未做相应改变；删除父表的某记录后，子表的相应记录未删除，致使这些记录成为孤立记录；对于子表插入的记录，父表中没有相应关键字值的记录，等等。对于这些设计表间数据的完整性，统称为参照完整性。

数据完整性 Data Integrity
数据完整性是指数据的精确性（Accuracy）和可靠性（Reliability）。它是应防止数据库中存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。数据完整性分为四类：实体完整性（Entity Integrity）、域完整性（Domain Integrity）、参照完整性（Referential Integrity）、用户定义的完整性（User-defined Integrity）。

#### 设计原则

概述
数据库设计（Database Design）是指根据用户的需求，在某一具体的数据库管理系统上，设计数据库的结构和建立数据库的过程，就是规划和结构化数据库中的数据对象以及这些数据对象之间关系的过程。数据库设计原则主要从规范化、数据完整性、分级设计、高内聚、低耦合、整体性、高效性几个方面进行阐述，是各应用系统数据库建设的基本要求和基本原则。所有数据库的建设应在满足上述原则的基础上，进行个性化的扩展设计。

设计规范化原则
对数据库的设计，完全采用 E-R 模型设计思想，并遵循关系数据库设计第三范式（3NF）标准要求。范式是数据库设计所需要满足的规范，满足这些规范的数据库是简洁的、结构明晰的，同时，不会发生插入（insert）、删除（delete）和更新（update）操作异常。数据库设计应遵循以数据库三范式为主导的设计原则，尽量保证数据的一致性、减少数据冗余。对于有较高性能及其它特殊要求的情况，可以考虑以“空间换时间”的设计方式。第三范式（3NF）要求一个数据库表中不包含已在其它表中已包含的非主关键字信息。

数据完整性原则
数据完整性是为防止数据库中存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的，数据完整性确保了数据库中的信息不会被篡改。如果数据具有完整性，则表示数据有效（正确并且准确），而且数据库的关系结构是完整的。参照完整性约束可以加强数据库的关系结构，这些规则使数据在各个表之间保持一致。

数据安全性原则
数据库的安全性是指保护数据，防止非法用户使用数据库或合法用户非法使用数据库造成数据泄露、更改或破坏。
系统在设计时要充分考虑到数据安全性，不同权限的用户看到的数据是存在差异的，通过制定对数据库的各类操作的标准，建立具有统一的管理和控制功能，例如：即使是系统管理员也无法知道用户的口令，因此无法以用户的身份进行登录。

分级设计原则
a）需求分析阶段：综合并分析各个用户的应用需求。
b）概念设计阶段：形成独立于机器特点，独立于各个 DBMS 产品的概念模式(E-R 图)。
c）逻辑设计阶段：首先将 E-R 图转换成具体的数据库产品支持的数据模型，如关系模型，形成数据库逻辑模式，然后根据用户处理的要求、安全性的考虑，在基本表的基础上再建立必要的视图(View)，形成数据的外模式。
d）物理设计阶段：根据 DBMS 特点和处理的需要，进行物理存储安排，建立索引，形成数据库内模式。按照需求分析、概念设计、逻辑设计、物理设计四个过程进行设计，形成一个统一的、稳定的、可扩展、安全的数据库方案。

高内聚原则
将数据库中公共使用的基础数据元和数据集独立建立基础数据库，同一数据中心内以数据库授权等
形式访问基础库中的数据，避免重复设计和存储。对基础数据进行统一管理，保证数据的一致性。

低耦合原则
应用系统在数据库的设计上应该避免直接调用其它应用系统的数据库，对数据库进行独立建库和独立维护，降低因为其它应用系统数据库变更而引起的威胁，但要遵循统一的数据库规范和命名规则。
基础库的独立设计，同一数据中心内以数据库授权等形式访问基础库中的数据，而不是重复设计、存储。

#### 命名规范
基本命名规范
a）语言
命名宜使用拼音简写，不宜使用中文或者特殊字符。当出现对象名重名且不同类型对象时，宜加类型前缀或后缀以示区别。
b）大小写
名称宜大写，方便不同数据库移植，避免程序调用问题。
c）单词分隔
命名的各单词之间可以使用下划线进行分隔。
d）保留字
命名不宜使用 SQL 保留字。
e）命名长度
表名、字段名、视图名长度应限制在 20 个字符内(含前缀)。
f）字段名称
同一个字段名在一个数据库中只能代表一个意思。比如 telephone 在一个表中代表“电话号码”的意思，在另外一个表中就不能代表“手机号码”的意思。

数据库对象命名规范
a）表
1）实体（表）
前缀为系统标识，<系统标识>_<表标识>。
表标识建议为拼音简称。
2）属性（列）
COMP_CODE，字段名称应用字母开头，采用有特征含义的单词或缩写，不宜用双引号包含。
b）视图
前缀为 V_，v_[<系统标识>]_<视图标识>。
视图标识建议为拼音简称。
c）存储过程
前缀为 P_，p_[<系统标识>]_<存储过程标识>。
存储过程标识建议为拼音简称。
d）函数
前缀为 F_，f_[<系统标识>]_<函数标识>。
函数标识建议为拼音简称。
e）触发器
tr_<表标识>_<i,u,d 的任意组合>(after)；
ti_<表标识>_<i,u,d 的任意组合>(instead)。
f）自定义数据类型
ud_<自定义数据类型标识>_<数据类型>。
g）Default
Df_<Default 标识>。
h）Rule
ru_<Rule 标识>。
i）主键
前缀为 PK_，pk_<表标识>_<主键标识>。
j）外键
前缀为 FK_，fk_<表标识>_<主表标识>_<外键标识>。
k）索引
前缀为 IDX_，IDX_<表标识>_<构成的字段名>。如果复合索引的构成字段较多，则只包含第一个字
段，并添加序号。

#### 数据库设计


#### 数据库存储规范

数据存取层介于语言处理层和数据存储层之间。它向上提供单元组接口，即导航式的一次一个元组的存取操作，向下则以系统缓冲区的存储器接口作为实现基础。数据存取层的任务是：
a）提供一次一个元组的查找、插入、删除、修改等基本操作。
b）提供元组查找所循的存取路径以及对存取路径的维护操作。如对索引记录的查找、插入、删除、修改。
c）对记录和存取路径的封锁、解锁操作。
d）日志文件的登记和读取操作。
e）辅助操作。如扫描、合并/排序，其操作对象有关系、有序表、索引等。
为了完成上述功能，通常把存取层又划分为若干功能子系统加以实现。存储引擎



## 数据库规范与其他技术的关系

### 与系统的关系
针对不同类型数据库系统，应采用不同的操作系统以及不同的数据库部署方式，选择操作系统环境应考虑数据库系统的需求。
示例：
对于中小型数据库系统，采用 Linux 操作系统比较合适，对于数据库冗余要求负载均衡能力要求较高的系统，可以采用数据库的集群方法，集群节点数范围在 2—64 个。对于大型数据库系统，可以采用小型机系统。RAD5 适合只读操作的数据库，RAD1 适合 OLTP 数据库。


### 与存储的关系

数据库涉及的存储主要有两种，内存和磁盘。
#### 内存要求
不同的操作系统管理内存的能力不同，不同的数据库系统对内存的要求也不同，建议根据操作系统环境和数据库系统规模选择适当的数据库内存。
示例：
对于 Linux 操作系统下的数据库，由于在正常情况下对数据库内存的管理能力不超过 1.7GB。所以总的物理内存在 4GB 以下。数据库内存的大小为物理内存的 50%—75%。对于 64 位的小型系统，数据库内存的管理超过 2GB 的限制，数据库内存设计在一个合适的范围内：物理内存的 50%— 70%，当数据库内存过大的时候会导致内存分页，影响系统性能。
当物理内存在 2GB 以下的情况下，交换分区 swap 为物理内存的 3 倍，当物理内存>2GB 的情况下，swap 大小为物理内存的 1—2 倍，当物理内存>8GB 时，swap 交换区仅设置为 8GB 即可。

#### 磁盘要求



## 数据库设计规范市场状况




## 数据库设计辅助工具应用场景

## 总结