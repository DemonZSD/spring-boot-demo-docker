<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.weshzhu.dbtool.doc.dao.ColumnsDao">

    <resultMap type="org.weshzhu.dbtool.common.entity.Columns" id="ColumnsMap">
        <result property="tableCatalog" column="TABLE_CATALOG" jdbcType="VARCHAR"/>
        <result property="tableSchema" column="TABLE_SCHEMA" jdbcType="VARCHAR"/>
        <result property="tableName" column="TABLE_NAME" jdbcType="VARCHAR"/>
        <result property="columnName" column="COLUMN_NAME" jdbcType="VARCHAR"/>
        <result property="ordinalPosition" column="ORDINAL_POSITION" jdbcType="INTEGER"/>
        <result property="columnDefault" column="COLUMN_DEFAULT" jdbcType="VARCHAR"/>
        <result property="isNullable" column="IS_NULLABLE" jdbcType="VARCHAR"/>
        <result property="dataType" column="DATA_TYPE" jdbcType="VARCHAR"/>
        <result property="characterMaximumLength" column="CHARACTER_MAXIMUM_LENGTH" jdbcType="INTEGER"/>
        <result property="characterOctetLength" column="CHARACTER_OCTET_LENGTH" jdbcType="INTEGER"/>
        <result property="numericPrecision" column="NUMERIC_PRECISION" jdbcType="INTEGER"/>
        <result property="numericScale" column="NUMERIC_SCALE" jdbcType="INTEGER"/>
        <result property="datetimePrecision" column="DATETIME_PRECISION" jdbcType="INTEGER"/>
        <result property="characterSetName" column="CHARACTER_SET_NAME" jdbcType="VARCHAR"/>
        <result property="collationName" column="COLLATION_NAME" jdbcType="VARCHAR"/>
        <result property="columnType" column="COLUMN_TYPE" jdbcType="VARCHAR"/>
        <result property="columnKey" column="COLUMN_KEY" jdbcType="VARCHAR"/>
        <result property="extra" column="EXTRA" jdbcType="VARCHAR"/>
        <result property="privileges" column="PRIVILEGES" jdbcType="VARCHAR"/>
        <result property="columnComment" column="COLUMN_COMMENT" jdbcType="VARCHAR"/>
        <result property="generationExpression" column="GENERATION_EXPRESSION" jdbcType="VARCHAR"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryByColumnName" resultMap="ColumnsMap">
        select TABLE_CATALOG,
               TABLE_SCHEMA,
               TABLE_NAME,
               COLUMN_NAME,
               ORDINAL_POSITION,
               COLUMN_DEFAULT,
               IS_NULLABLE,
               DATA_TYPE,
               CHARACTER_MAXIMUM_LENGTH,
               CHARACTER_OCTET_LENGTH,
               NUMERIC_PRECISION,
               NUMERIC_SCALE,
               DATETIME_PRECISION,
               CHARACTER_SET_NAME,
               COLLATION_NAME,
               COLUMN_TYPE,
               COLUMN_KEY,
               EXTRA,
               PRIVILEGES,
               COLUMN_COMMENT,
               GENERATION_EXPRESSION
        from COLUMNS
        where TABLE_SCHEMA= #{schemaName}
          and TABLE_NAME=#{tableName}
          and COLUMN_NAME=#{columnName}
    </select>

    <select id="queryBySchema" resultMap="ColumnsMap">
        select TABLE_CATALOG,
        TABLE_SCHEMA,
        TABLE_NAME,
        COLUMN_NAME,
        ORDINAL_POSITION,
        COLUMN_DEFAULT,
        IS_NULLABLE,
        DATA_TYPE,
        CHARACTER_MAXIMUM_LENGTH,
        CHARACTER_OCTET_LENGTH,
        NUMERIC_PRECISION,
        NUMERIC_SCALE,
        DATETIME_PRECISION,
        CHARACTER_SET_NAME,
        COLLATION_NAME,
        COLUMN_TYPE,
        COLUMN_KEY,
        EXTRA,
        PRIVILEGES,
        COLUMN_COMMENT,
        GENERATION_EXPRESSION
        from COLUMNS
        where TABLE_SCHEMA= #{schemaName}
        order by TABLE_NAME desc, COLUMN_NAME desc
    </select>
    <!--统计总行数-->
    <select id="count" resultType="java.lang.Long">
        select count(1)
        from COLUMNS
        <where>
            <if test="tableCatalog != null and tableCatalog != ''">
                and TABLE_CATALOG = #{tableCatalog}
            </if>
            <if test="tableSchema != null and tableSchema != ''">
                and TABLE_SCHEMA = #{tableSchema}
            </if>
            <if test="tableName != null and tableName != ''">
                and TABLE_NAME = #{tableName}
            </if>
            <if test="columnName != null and columnName != ''">
                and COLUMN_NAME = #{columnName}
            </if>
            <if test="ordinalPosition != null">
                and ORDINAL_POSITION = #{ordinalPosition}
            </if>
            <if test="columnDefault != null and columnDefault != ''">
                and COLUMN_DEFAULT = #{columnDefault}
            </if>
            <if test="isNullable != null and isNullable != ''">
                and IS_NULLABLE = #{isNullable}
            </if>
            <if test="dataType != null and dataType != ''">
                and DATA_TYPE = #{dataType}
            </if>
            <if test="characterMaximumLength != null">
                and CHARACTER_MAXIMUM_LENGTH = #{characterMaximumLength}
            </if>
            <if test="characterOctetLength != null">
                and CHARACTER_OCTET_LENGTH = #{characterOctetLength}
            </if>
            <if test="numericPrecision != null">
                and NUMERIC_PRECISION = #{numericPrecision}
            </if>
            <if test="numericScale != null">
                and NUMERIC_SCALE = #{numericScale}
            </if>
            <if test="datetimePrecision != null">
                and DATETIME_PRECISION = #{datetimePrecision}
            </if>
            <if test="characterSetName != null and characterSetName != ''">
                and CHARACTER_SET_NAME = #{characterSetName}
            </if>
            <if test="collationName != null and collationName != ''">
                and COLLATION_NAME = #{collationName}
            </if>
            <if test="columnType != null and columnType != ''">
                and COLUMN_TYPE = #{columnType}
            </if>
            <if test="columnKey != null and columnKey != ''">
                and COLUMN_KEY = #{columnKey}
            </if>
            <if test="extra != null and extra != ''">
                and EXTRA = #{extra}
            </if>
            <if test="privileges != null and privileges != ''">
                and PRIVILEGES = #{privileges}
            </if>
            <if test="columnComment != null and columnComment != ''">
                and COLUMN_COMMENT = #{columnComment}
            </if>
            <if test="generationExpression != null and generationExpression != ''">
                and GENERATION_EXPRESSION = #{generationExpression}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="" useGeneratedKeys="true">
        insert into COLUMNS(TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, ORDINAL_POSITION, COLUMN_DEFAULT,
                            IS_NULLABLE, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH, CHARACTER_OCTET_LENGTH, NUMERIC_PRECISION,
                            NUMERIC_SCALE, DATETIME_PRECISION, CHARACTER_SET_NAME, COLLATION_NAME, COLUMN_TYPE,
                            COLUMN_KEY, EXTRA, PRIVILEGES, COLUMN_COMMENT, GENERATION_EXPRESSION)
        values (#{tableCatalog}, #{tableSchema}, #{tableName}, #{columnName}, #{ordinalPosition}, #{columnDefault},
                #{isNullable}, #{dataType}, #{characterMaximumLength}, #{characterOctetLength}, #{numericPrecision},
                #{numericScale}, #{datetimePrecision}, #{characterSetName}, #{collationName}, #{columnType},
                #{columnKey}, #{extra}, #{privileges}, #{columnComment}, #{generationExpression})
    </insert>

    <insert id="insertBatch" keyProperty="" useGeneratedKeys="true">
        insert into COLUMNS(TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, ORDINAL_POSITION, COLUMN_DEFAULT,
        IS_NULLABLE, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH, CHARACTER_OCTET_LENGTH, NUMERIC_PRECISION, NUMERIC_SCALE,
        DATETIME_PRECISION, CHARACTER_SET_NAME, COLLATION_NAME, COLUMN_TYPE, COLUMN_KEY, EXTRA, PRIVILEGES,
        COLUMN_COMMENT, GENERATION_EXPRESSION)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.tableCatalog}, #{entity.tableSchema}, #{entity.tableName}, #{entity.columnName},
            #{entity.ordinalPosition}, #{entity.columnDefault}, #{entity.isNullable}, #{entity.dataType},
            #{entity.characterMaximumLength}, #{entity.characterOctetLength}, #{entity.numericPrecision},
            #{entity.numericScale}, #{entity.datetimePrecision}, #{entity.characterSetName}, #{entity.collationName},
            #{entity.columnType}, #{entity.columnKey}, #{entity.extra}, #{entity.privileges}, #{entity.columnComment},
            #{entity.generationExpression})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="" useGeneratedKeys="true">
        insert into COLUMNS(TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, ORDINAL_POSITION, COLUMN_DEFAULT,
        IS_NULLABLE, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH, CHARACTER_OCTET_LENGTH, NUMERIC_PRECISION, NUMERIC_SCALE,
        DATETIME_PRECISION, CHARACTER_SET_NAME, COLLATION_NAME, COLUMN_TYPE, COLUMN_KEY, EXTRA, PRIVILEGES,
        COLUMN_COMMENT, GENERATION_EXPRESSION)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.tableCatalog}, #{entity.tableSchema}, #{entity.tableName}, #{entity.columnName},
            #{entity.ordinalPosition}, #{entity.columnDefault}, #{entity.isNullable}, #{entity.dataType},
            #{entity.characterMaximumLength}, #{entity.characterOctetLength}, #{entity.numericPrecision},
            #{entity.numericScale}, #{entity.datetimePrecision}, #{entity.characterSetName}, #{entity.collationName},
            #{entity.columnType}, #{entity.columnKey}, #{entity.extra}, #{entity.privileges}, #{entity.columnComment},
            #{entity.generationExpression})
        </foreach>
        on duplicate key update
        TABLE_CATALOG = values(TABLE_CATALOG),
        TABLE_SCHEMA = values(TABLE_SCHEMA),
        TABLE_NAME = values(TABLE_NAME),
        COLUMN_NAME = values(COLUMN_NAME),
        ORDINAL_POSITION = values(ORDINAL_POSITION),
        COLUMN_DEFAULT = values(COLUMN_DEFAULT),
        IS_NULLABLE = values(IS_NULLABLE),
        DATA_TYPE = values(DATA_TYPE),
        CHARACTER_MAXIMUM_LENGTH = values(CHARACTER_MAXIMUM_LENGTH),
        CHARACTER_OCTET_LENGTH = values(CHARACTER_OCTET_LENGTH),
        NUMERIC_PRECISION = values(NUMERIC_PRECISION),
        NUMERIC_SCALE = values(NUMERIC_SCALE),
        DATETIME_PRECISION = values(DATETIME_PRECISION),
        CHARACTER_SET_NAME = values(CHARACTER_SET_NAME),
        COLLATION_NAME = values(COLLATION_NAME),
        COLUMN_TYPE = values(COLUMN_TYPE),
        COLUMN_KEY = values(COLUMN_KEY),
        EXTRA = values(EXTRA),
        PRIVILEGES = values(PRIVILEGES),
        COLUMN_COMMENT = values(COLUMN_COMMENT),
        GENERATION_EXPRESSION = values(GENERATION_EXPRESSION)
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update COLUMNS
        <set>
            <if test="tableCatalog != null and tableCatalog != ''">
                TABLE_CATALOG = #{tableCatalog},
            </if>
            <if test="tableSchema != null and tableSchema != ''">
                TABLE_SCHEMA = #{tableSchema},
            </if>
            <if test="tableName != null and tableName != ''">
                TABLE_NAME = #{tableName},
            </if>
            <if test="columnName != null and columnName != ''">
                COLUMN_NAME = #{columnName},
            </if>
            <if test="ordinalPosition != null">
                ORDINAL_POSITION = #{ordinalPosition},
            </if>
            <if test="columnDefault != null and columnDefault != ''">
                COLUMN_DEFAULT = #{columnDefault},
            </if>
            <if test="isNullable != null and isNullable != ''">
                IS_NULLABLE = #{isNullable},
            </if>
            <if test="dataType != null and dataType != ''">
                DATA_TYPE = #{dataType},
            </if>
            <if test="characterMaximumLength != null">
                CHARACTER_MAXIMUM_LENGTH = #{characterMaximumLength},
            </if>
            <if test="characterOctetLength != null">
                CHARACTER_OCTET_LENGTH = #{characterOctetLength},
            </if>
            <if test="numericPrecision != null">
                NUMERIC_PRECISION = #{numericPrecision},
            </if>
            <if test="numericScale != null">
                NUMERIC_SCALE = #{numericScale},
            </if>
            <if test="datetimePrecision != null">
                DATETIME_PRECISION = #{datetimePrecision},
            </if>
            <if test="characterSetName != null and characterSetName != ''">
                CHARACTER_SET_NAME = #{characterSetName},
            </if>
            <if test="collationName != null and collationName != ''">
                COLLATION_NAME = #{collationName},
            </if>
            <if test="columnType != null and columnType != ''">
                COLUMN_TYPE = #{columnType},
            </if>
            <if test="columnKey != null and columnKey != ''">
                COLUMN_KEY = #{columnKey},
            </if>
            <if test="extra != null and extra != ''">
                EXTRA = #{extra},
            </if>
            <if test="privileges != null and privileges != ''">
                PRIVILEGES = #{privileges},
            </if>
            <if test="columnComment != null and columnComment != ''">
                COLUMN_COMMENT = #{columnComment},
            </if>
            <if test="generationExpression != null and generationExpression != ''">
                GENERATION_EXPRESSION = #{generationExpression},
            </if>
        </set>
        where = #{}
    </update>

</mapper>

